{
    "name": "RetryTimeout",
    "title": "Retry and Timeout",
    "description": "Learn how to use the MicroProfile Retry and Timeout policies.",
    "duration": "20 minutes",
    "audience": "developer",
    "repo": "https://github.com/OpenLiberty/draft-iguide-retry-timeout",
    "steps": [
        {
            "name": "Intro",
            "title": "What you'll learn",
            "guide_duration" : "20 minutes",
            "description": [
                "Explore how to use <a href='https://microprofile.io/' target='_blank'>MicroProfile</a> Retry and Timeout policies from the <a href='https://github.com/eclipse/microprofile-fault-tolerance' target='_blank'>Fault Tolerance feature</a> to make your microservice more resilient to common failures.",
                "You'll start with a sample bank scenario and experience a not-so-uncommon network blip. You'll then enable MicroProfile Fault Tolerance and use the Timeout policy to quickly fail requests that are hanging for too long. Finally, you'll explore the Retry policy and how it can help overcome brief unpredictable failures your application may experience."
            ],
            "sections" : [
                {
                    "name": "backgroundConcepts",
                    "title": "Background concepts",
                    "description": [
                        "In this guide, we use the MicroProfile <b>Timeout</b> and <b>Retry</b> policies to fail quickly and recover from brief intermittent issues. An application may experience these <b>transient failures</b>, especially when it needs to fetch data remotely. Perhaps the database was overloaded by queries, the network connection became unstable, or the site host had a brief downtime. Using Timeout and Retry together can help overcome or alleviate these kinds of transient failures.",
                        "<h4>Timeout</h4>",
                        "In some cases, the user may experience a page loading for a long time, only to never finish. Timeout can help by ending requests that have taken too long and are unlikely to return successfully. This is useful to fail quickly without drawing out the waiting time.",
                        "<h4>Retry</h4>",
                        "Sometimes, the underlying issues may be short-lived. In these cases, rather than failing quickly on these transient failures, give the request another chance with the Retry policy. Simply retrying the request after a few seconds may be all you need to avoid showing a dreaded error page."
                    ]
                }
            ]
        },
        {
            "name": "BankScenario",
            "title": "Example: bank scenario",
            "description": [
                "Imagine that you're developing an online transaction history microservice for a bank to allow clients to check their transaction history. When a customer tries to view their transaction history, occasionally an unforeseen problem may prevent the data from loading and result in a needlessly long or indefinite page load."
            ],
            "sections": [
                {
                    "name": "TransactionHistory",
                    "title": "Request transaction history",
                    "description": [
                        "Begin by requesting an online transaction history."
                    ],
                    "instruction": [
                        "Enter the following URL into the browser that follows, or click <action title='URL' onclick=\"retryTimeoutCallback.populateURL(event, 'TransactionHistory')\"><b>https://global-ebank.openliberty.io/transactions</b></action> and then press <action title='Enter' onclick=\"retryTimeoutCallback.clickTransaction(event, 'TransactionHistory', 1)\"><b>Enter</b></action> to retrieve a transaction history.",
                        "Click <action title='Refresh' onclick=\"retryTimeoutCallback.clickTransaction(event, 'TransactionHistory', 2)\"><b>Refresh</b></action> in the browser to see the page loads indefinitely unable to retrieve the transaction history."
                    ],
                    "content":[
                        {
                            "displayType":"webBrowser",
                            "url": "",
                            "browserContent": "",                          
                            "callback": "(function test(webBrowser) {retryTimeoutCallback.listenToBrowserForTransactionHistory(webBrowser); })"
                        }
                    ]
                }
            ]
        },
        {
            "name": "AddLibertyMPFaultTolerance",
            "title": "Enabling MicroProfile Fault Tolerance in Open Liberty",
            "description": [
                "Microprofile Fault Tolerance allows microservices to handle unavailable services. It uses different policies to guide the execution and result of some logic. The MicroProfile Fault Tolerance 1.0 feature provides an environment to support resilient microservices through patterns that include retry and timeout. Enable the MicroProfile Fault Tolerance 1.0 feature in the <code>server.xml</code> file of the Open Liberty server."
            ],
            "instruction": [
                "Add the following element declaration inside the featureManager element of the <code>server.xml</code> file, or click <action title='Enable MicroProfile Fault Tolerance' onclick=\"retryTimeoutCallback.addMicroProfileFaultToleranceFeatureButton(event)\"><b>&lt;feature>mpFaultTolerance-1.0&lt;/feature&gt;</b></action>. Then, click <action title='Save' onclick=\"retryTimeoutCallback.saveServerXMLButton(event)\"><b>Save</b></action> on the editor menu pane."
            ],
            "content": [
                {
                    "displayType": "tabbedEditor",
                    "editorList": [
                        {
                            "displayType": "fileEditor",
                            "fileName": "server.xml",
                            "editorHeight": "300px",
                            "preload": [
                                "<?xml version=\"1.0\"?>",
                                "<server description=\"Sample Liberty server\">",
                                "   <featureManager>",
                                "      <feature>cdi-1.2</feature>",
                                "   </featureManager>",
                                "   <httpEndpoint host=\"*\" id=\"defaultHttpEndpoint\" httpsPort=\"${default.https.port}\" httpPort=\"{default.http.port}\"/>",
                                "</server>"
                            ],
                            "save": true,
                            "readonly": [
                                {
                                    "from": "1",
                                    "to": "3"
                                },
                                {
                                    "from": "5",
                                    "to": "7"
                                }
                            ],
                            "callback": "(function test(editor) {retryTimeoutCallback.listenToEditorForFeatureInServerXML(editor); })"
                        }
                    ]
                }
            ]
        },
        {
            "name": "TimeoutAnnotation",
            "title": "Adding the @Timeout annotation",
            "description": [
                "Now that you’ve seen the page loads indefinitely when there is some problem on the server end, let's apply a Timeout policy to limit the time the request is made to a transaction history and to prevent the page from loading for a long time.",
                "The <code>@Timeout</code> annotation takes an integer value that specifies the time allowed for the request to finish. The value must be greater than or equal to <code>0</code>. A value of <code>0</code> means that no timeout is configured. If the value is not specified, the default is <code>1000</code> milliseconds.",
                "The <code>@Timeout</code> annotation can also be configured to change the default time unit from milliseconds, for example, <code>@Timeout(value=2, unit=ChronoUnit.SECONDS)</code> with the following parameters:",
                "<ul><li><b>value</b>: The value that specifies the time allowed for the request to finish.</li><li><b>unit</b>: The unit of time for the <code>value</code> parameter as described by <code>java.time.temporal.ChronoUnit</code>. The default is <code>ChronoUnit.MILLIS</code> for milliseconds.</li>The java.time.temporal.ChronoUnit</code> class defines a standard set of date period units, including <code>NANOS, MICROS, MILLIS, SECONDS, MINUTES</code>, and <code>HOURS.</code></ul>",
                "With a Timeout policy, the microservice fails with a <code>TimeoutException</code> when the set amount of time passes after the request is made.",
                "After you modify your <code>server.xml</code> file to <a href='#enabling-microprofile-fault-tolerance-in-open-liberty'> include the Fault Tolerance feature</a>, add a Timeout policy to the transaction history microservice."
            ],
            "instruction": [
                "Add the <code>@Timeout</code> annotation with a value of <code>2000</code> on line 7, before the <code>showTransactions</code> method, or click <action title='Add @Timeout' onclick=\"retryTimeoutCallback.addTimeoutButton(event, 'TimeoutAnnotation')\">@Timeout(2000)</action>. This annotation limits the allowed time for the transaction history request to 2000 milliseconds before a <code>TimeoutException</code> occurs. Then, click <action title='Run' onclick=\"retryTimeoutCallback.saveButtonEditor(event, 'TimeoutAnnotation')\"><b>Run</b></action> on the editor menu pane."
            ],
            "content": [
                {
                    "displayType": "tabbedEditor",
                    "editorList": [
                        {
                            "displayType": "fileEditor",
                            "fileName": "BankService.java",
                            "editorHeight": "390px",
                            "preload": [
                                "package io.openliberty.guides.retrytimeout.global.eBank.microservices;",
                                "import javax.enterprise.context.ApplicationScoped;",
                                "import org.eclipse.microprofile.faulttolerance.Timeout;",
                                "",
                                "@ApplicationScoped",
                                "public class BankService {",
                                "",
                                "    public Service showTransactions() throws Exception {",
                                "        Service transactions = new Transactions();",
                                "        transactions.getTransactions();",
                                "        return transactions;",
                                "    }",
                                "}"
                            ],
                            "readonly": [
                                {
                                    "from": "1",
                                    "to": "6"
                                },
                                {
                                    "from": "8",
                                    "to": "13"
                                }
                            ],
                            "save": false,
                            "callback": "(function test(tabbedEditor) {retryTimeoutCallback.listenToEditorForTimeoutAnnotation(tabbedEditor); })"
                        }
                    ]
                },
                {
                    "displayType": "pod"
                }
            ]
        },
        {
            "name": "AddRetryOnRetry",
            "title": "Adding the @Retry annotation",
            "description": [
                "A Retry policy helps an application recover from transient failures, like a temporary network glitch. The MicroProfile <code>@Retry</code> annotation defines when to re-attempt an operation that has failed. The policy parameters include options that identify how many retry attempts should be allowed, how long to continue to retry an operation, or how to set a retry or abort condition based on a specific exception.",
                "A request to a service may fail for many different reasons. The default Retry policy initiates a retry for every <code>Throwable</code>.  However, you can base a Retry policy on a specific exception using the <code>retryOn</code> parameter.",
                "<ul><li><b>retryOn:</b> Specifies an exception class that triggers a retry. You can identify more than one exception as an array of values.  For example,<br><span style='margin-left: 10px;'><code>@Retry(retryOn={RuntimeException.class, TimeoutException.class})</code>.</span><br>The default is <code>java.lang.Exception.class</code>.",
                "</ul>",
                "After modifying the <code>server.xml</code> file to <a href='#enabling-microprofile-fault-tolerance-in-open-liberty'> include the Fault Tolerance feature</a>, we added a Timeout policy to our sample application which will cause the transaction history microservice to fail with a <code>TimeoutException</code> if the request does not complete within 2000 milliseconds.  Now, let's add a Retry policy to the code to retry the request to the transaction history microservice when a Timeout condition occurs."
            ],
            "instruction": [
                "Add the <code>@Retry</code> annotation on line 12, before the <code>showTransactions</code> method, to retry the service request only when a <code>TimeoutException</code> occurs, or click<br> <action title='Add @Retry with the retryOn parameter' onclick=\"retryTimeoutCallback.addRetryAnnotationButton(event, 'AddRetryOnRetry')\">@Retry(retryOn = TimeoutException.class)</action>.<br> Then, click <action title='Run' onclick=\"retryTimeoutCallback.saveButtonEditor(event, 'AddRetryOnRetry')\"><b>Run</b></action> on the editor menu pane.",
                "With this Retry policy in place, the request to the View Transaction microservice is automatically retried if a <code>TimeoutException</code> occurs. To demonstrate, enter the following URL into the browser that follows, or click <action title='URL to retrieve transaction history' onclick=\"retryTimeoutCallback.populateURL(event, 'AddRetryOnRetry')\"><b>https://global-ebank.openliberty.io/transactions</b></action> and then press <action title='Enter' onclick=\"retryTimeoutCallback.clickTransaction(event, 'AddRetryOnRetry', 0)\"><b>Enter</b></action> to retrieve the account transaction history.  The initial request times out after 2 seconds. However, instead of posting an error message, the request is automatically retried and you will see the transaction history appear."
            ],
            "content": [
                {
                    "displayType": "tabbedEditor",
                    "editorList": [
                        {
                            "displayType": "tabbedEditor",
                            "fileName": "BankService.java",
                            "preload": [
                                "package io.openliberty.guides.retrytimeout.global.eBank.microservices;",
                                "",
                                "import javax.enterprise.context.ApplicationScoped;",
                                "import java.time.temporal.ChronoUnit;",
                                "",
                                "import org.eclipse.microprofile.faulttolerance.Retry;",
                                "import org.eclipse.microprofile.faulttolerance.Timeout;",
                                "import org.eclipse.microprofile.faulttolerance.exceptions.TimeoutException;",
                                "",
                                "@ApplicationScoped",
                                "public class BankService {",
                                "",
                                "    @Timeout(2000)",
                                "    public Service showTransactions() throws Exception {",
                                "       Service transactions = new Transactions();",
                                "       transactions.getTransactions();",
                                "       return transactions;",
                                "   }", 
                                "}"
                            ],
                            "readonly": [
                                {
                                    "from": "1",
                                    "to": "11"
                                },
                                {
                                    "from": "13",
                                    "to": "19"
                                }
                            ],
                            "editorHeight": "390px",
                            "save": false,
                            "callback": "(function test(editor) {retryTimeoutCallback.listenToEditorForInitialRetryAnnotation(editor); })"
                        }    
                    ]
                },
                {
                    "displayType": "pod"
                }
            ]
        },
        {
            "name": "AddLimitsRetry",
            "title": "Adding retry limits",
            "TOCIndent": 1,
            "description": [
                "You can set limits on the number of retry attempts to prevent a busy service from becoming overloaded with retry requests, tying up resources and taking even longer to recover from its failing condition. The <code>@Retry</code> annotation has parameters that limit the number of retry attempts and that limit the amount of time a service can spend retrying.",
                "<ul><li><b>maxRetries:</b> The maximum number of retry requests. A value of <code>-1</code> indicates to continue retrying forever. The default is <code>3</code> requests.",
                "<li><b>maxDuration:</b> The maximum amount of time to perform all requests, including the initial request and all retry attempts. Once the duration is reached, no more retry attempts are initiated.  The default is <code>180000</code> units, as defined by the <code>durationUnit</code> parameter.",
                "<li><b>durationUnit:</b> The unit of time for the <code>maxDuration</code> parameter as described by <code>java.time.temporal.ChronoUnit</code>. The default is <code>ChronoUnit.MILLIS</code> for milliseconds.<p style='margin-top: inherit;'>The <code>java.time.temporal.ChronoUnit</code> class defines a standard set of date period units, including <code>NANOS, MICROS, MILLIS, SECONDS, MINUTES,</code> and <code>HOURS</code>.",
                "</ul>"
            ],
            "instruction": [
                "Update the <code>@Retry</code> annotation on line 13 to limit the number of retry attempts to 4 and the retry duration to 10 seconds, or click<br> <action title='Add @Retry with maxRetries and maxDuration' onclick=\"retryTimeoutCallback.addRetryAnnotationButton(event, 'AddLimitsRetry')\">@Retry(retryOn = TimeoutException.class,\n       maxRetries=4,\n       maxDuration=10,\n       durationUnit = ChronoUnit.SECONDS)</action>.<br>This Retry policy initiates a retry request for each <code>TimeoutException</code> that occurs, but limits retry attempts to no more than 4 retries. The operation aborts if the total duration of all retries lasts more than 10 seconds.<br> Then, click <action title='Run' onclick=\"retryTimeoutCallback.saveButtonEditor(event, 'AddLimitsRetry')\"><b>Run</b></action> on the editor menu pane.",
                "Enter the following URL into the browser that follows, or click <action title='URL to retrieve transaction history' onclick=\"retryTimeoutCallback.populateURL(event, 'AddLimitsRetry')\"><b>https://global-ebank.openliberty.io/transactions</b></action> and then press <action title='Enter' onclick=\"retryTimeoutCallback.clickTransaction(event, 'AddLimitsRetry', 0)\"><b>Enter</b></action> to retrieve the account transaction history. The timeline shows that the initial request times out after 2 seconds.  The Retry policy re-attemps the request to the View Transaction microservice up to 4 times. Watch as the timeline shows these automatic retry attempts immediately following any timeouts that occur within 10 seconds, or until the trasaction history appears."
            ],
            "content": [
                {
                    "displayType": "tabbedEditor",
                    "editorList": [
                        {
                            "displayType": "tabbedEditor",
                            "fileName": "BankService.java",
                            "preload": [
                                "package io.openliberty.guides.retrytimeout.global.eBank.microservices;",
                                "",
                                "import javax.enterprise.context.ApplicationScoped;",
                                "import java.time.temporal.ChronoUnit;",
                                "",
                                "import org.eclipse.microprofile.faulttolerance.Retry;",
                                "import org.eclipse.microprofile.faulttolerance.Timeout;",
                                "import org.eclipse.microprofile.faulttolerance.exceptions.TimeoutException;",
                                "",
                                "@ApplicationScoped",
                                "public class BankService {",
                                "",
                                "    @Retry(retryOn = TimeoutException.class)",
                                "    @Timeout(2000)",
                                "    public Service showTransactions() throws Exception {",
                                "       Service transactions = new Transactions();",
                                "       transactions.getTransactions();",
                                "       return transactions;",
                                "   }", 
                                "}"
                            ],
                            "readonly": [
                                {
                                    "from": "1",
                                    "to": "12"
                                },
                                {
                                    "from": "14",
                                    "to": "20"
                                }
                            ],
                            "editorHeight": "468px",
                            "save": false,
                            "callback": "(function test(editor) {retryTimeoutCallback.listenToEditorForRetryAnnotation(editor); })" 
                        }    
                    ]
                },
                {
                    "displayType": "pod"
                }
            ]
        },
        {
            "name": "AddDelayRetry",
            "title": "Configuring a delay",
            "TOCIndent": 1,
            "description": [
                "Sometimes an application should wait before retrying a request to a service to decrease the chance that a previous failure reoccurs.  For example, to allow a sudden spike in requests to lessen or to allow connectivity issues to be resolved.  In this case, you can define a delay in the Retry policy. ",
                "<ul><li><b>delay:</b> The amount of time to wait before retrying a request.  The value must be greater than or equal to <code>0</code> and be less than the value for <a href='#adding-retry-limits'><b>maxDuration</b></a>.  The default is <code>0</code>.",
                "<li><b>delayUnit:</b> The unit of time for the <code>delay</code> parameter as described by <code>java.time.temporal.ChronoUnit</code>.  The default is ChronoUnit.MILLIS. <p style='margin-top: inherit;'>The <code>java.time.temporal.ChronoUnit</code> class defines a standard set of date period units, including <code>NANOS, MICROS, MILLIS, SECONDS, MINUTES,</code> and <code>HOURS</code>.",
                "<ul>"
            ],
            "instruction": [
                "Update the <code>@Retry</code> annotation on lines 13-16 to include a delay of 200ms, or click<br><action title='Add @Retry with delay' onclick=\"retryTimeoutCallback.addRetryAnnotationButton(event, 'AddDelayRetry')\">@Retry(retryOn = TimeoutException.class,\n       maxRetries=4,\n       maxDuration=10,\n       durationUnit = ChronoUnit.SECONDS,\n       delay=200, delayUnit = ChronoUnit.MILLIS)</action>.<br> This indicates there should be a delay of 200ms following each timeout failure from the View Transaction microservice before retrying another request, but no more than 4 retries should occur and retry attempts should stop after 10 seconds.<br> Then, click <action title='Run' onclick=\"retryTimeoutCallback.saveButtonEditor(event, 'AddDelayRetry')\"><b>Run</b></action> on the editor menu pane.",
                "Enter the following URL into the browser that follows, or click <action title='URL to retrieve transaction history' onclick=\"retryTimeoutCallback.populateURL(event, 'AddDelayRetry')\"><b>https://global-ebank.openliberty.io/transactions</b></action> and then press <action title='Enter' onclick=\"retryTimeoutCallback.clickTransaction(event, 'AddDelayRetry', 0)\"><b>Enter</b></action> to retrieve the account transaction history. The timeline shows how the Retry policy automatically initiates another request to the View Transaction microservice 200ms after each timeout (2000ms) that occurs until the transaction history is displayed."
            ],
            "content": [
                {
                    "displayType": "tabbedEditor",
                    "editorList": [
                        {
                            "displayType": "tabbedEditor",
                            "fileName": "BankService.java",
                            "preload": [
                                "package io.openliberty.guides.retrytimeout.global.eBank.microservices;",
                                "",
                                "import javax.enterprise.context.ApplicationScoped;",
                                "import java.time.temporal.ChronoUnit;",
                                "",
                                "import org.eclipse.microprofile.faulttolerance.Retry;",
                                "import org.eclipse.microprofile.faulttolerance.Timeout;",
                                "import org.eclipse.microprofile.faulttolerance.exceptions.TimeoutException;",
                                "",
                                "@ApplicationScoped",
                                "public class BankService {",
                                "",
                                "    @Retry(retryOn = TimeoutException.class,",
                                "           maxRetries=4,",
                                "           maxDuration=10,",
                                "           durationUnit = ChronoUnit.SECONDS)",
                                "    @Timeout(2000)",
                                "    public Service showTransactions() throws Exception {",
                                "       Service transactions = new Transactions();",
                                "       transactions.getTransactions();",
                                "       return transactions;",
                                "   }", 
                                "}"
                            ],
                            "readonly": [
                                {
                                    "from": "1",
                                    "to": "12"
                                },
                                {
                                    "from": "17",
                                    "to": "23"
                                }
                            ],
                            "editorHeight": "468px",
                            "save": false,
                            "callback": "(function test(editor) {retryTimeoutCallback.listenToEditorForRetryAnnotation(editor); })"
                        }    
                    ]
                },
                {
                    "displayType": "pod"
                }
            ]
        },
        {
            "name": "AddJitterRetry",
            "title": "Adding jitter to the delay",
            "TOCIndent": 1,
            "description": [
                "The Retry policy also provides a way to add jitter to the delay.  Jitter causes a slight variation in the delay time applied between retries.  For example, a jitter of 200ms will randomly add between -200 and 200 ms to each retry delay interval.",
                "<ul><li><b>jitter:</b> A random variation applied to the <a href='#configuring-a-delay'>delay</a> interval between retries. The value must be greater than or equal to <code>0</code>. A value of <code>0</code> means that it is not set. The default is <code>200</code> units, as defined by the <code>jitterDelayUnit</code> parameter.",
                "<li><b>jitterDelayUnit:</b> The unit of time for the <code>jitter</code> parameter as described by <code>java.time.temporal.ChronoUnit</code>.  The default is ChronoUnit.MILLIS. <p style='margin-top: inherit;'>The <code>java.time.temporal.ChronoUnit</code> class defines a standard set of date period units, including <code>NANOS, MICROS, MILLIS, SECONDS, MINUTES,</code> and <code>HOURS</code>.",
                "</ul>",
                "Why would you want to add a jitter?  Suppose, for example, that multiple applications are making requests to your microservice causing it to become overloaded.  By adding a jitter to the delay time you allow the retry times of these requests to vary.  Therefore, the cluster of retry requests are spread out over time reducing the chance that the busy service continues to be overloaded."            ],
            "instruction": [
                "Add a jitter of 100ms to the delay in the <code>@Retry</code> annotation on lines 13-17, or click<br><action title='Add @Retry with jitter' onclick=\"retryTimeoutCallback.addRetryAnnotationButton(event, 'AddJitterRetry')\">@Retry(retryOn = TimeoutException.class,\n       maxRetries=4,\n       maxDuration=10,\n       durationUnit = ChronoUnit.SECONDS,\n       delay=200, delayUnit = ChronoUnit.MILLIS,\n       jitter=100,\n       jitterDelayUnit = ChronoUnit.MILLIS)</action>.<br> The delay between retries will now be spread out between 100 and 300 milliseconds.<br> Click <action title='Run' onclick=\"retryTimeoutCallback.saveButtonEditor(event, 'AddJitterRetry')\"><b>Run</b></action> on the editor menu pane.",
                "Enter the following URL into the browser that follows, or click <action title='URL to retrieve transaction history' onclick=\"retryTimeoutCallback.populateURL(event, 'AddJitterRetry')\"><b>https://global-ebank.openliberty.io/transactions</b></action> and then press <action title='Enter' onclick=\"retryTimeoutCallback.clickTransaction(event, 'AddJitterRetry', 0)\"><b>Enter</b></action> to retrieve the account transaction history. The Retry policy now includes a jitter of 100ms, so the timeline shows an attempt to display the transaction history occurring somewhere between 100 and 300 milliseconds (200ms delay +- 100ms jitter) after any timeout (2000ms) that occurs within 10 seconds."            
            ],
            "content": [
                {
                    "displayType": "tabbedEditor",
                    "editorList": [
                        {
                            "displayType": "tabbedEditor",
                            "fileName": "BankService.java",
                            "preload": [
                                "package io.openliberty.guides.retrytimeout.global.eBank.microservices;",
                                "",
                                "import javax.enterprise.context.ApplicationScoped;",
                                "import java.time.temporal.ChronoUnit;",
                                "",
                                "import org.eclipse.microprofile.faulttolerance.Retry;",
                                "import org.eclipse.microprofile.faulttolerance.Timeout;",
                                "import org.eclipse.microprofile.faulttolerance.exceptions.TimeoutException;",
                                "",
                                "@ApplicationScoped",
                                "public class BankService {",
                                "",
                                "    @Retry(retryOn = TimeoutException.class,",
                                "           maxRetries=4,",
                                "           maxDuration=10,",
                                "           durationUnit = ChronoUnit.SECONDS,",
                                "           delay=200, delayUnit = ChronoUnit.MILLIS)",
                                "    @Timeout(2000)",
                                "    public Service showTransactions() throws Exception {",
                                "       Service transactions = new Transactions();",
                                "       transactions.getTransactions();",
                                "       return transactions;",
                                "   }", 
                                "}"
                            ],
                            "readonly": [
                                {
                                    "from": "1",
                                    "to": "12"
                                },
                                {
                                    "from": "18",
                                    "to": "24"
                                }
                            ],
                            "editorHeight": "468px",
                            "save": false,
                            "callback": "(function test(editor) {retryTimeoutCallback.listenToEditorForRetryAnnotation(editor); })" 
                        }
                    ]
                },
                {
                    "displayType": "pod"
                }
            ]
        },
        {
            "name": "AddAbortOnRetry",
            "title": "Specifying an abort failure condition",
            "TOCIndent": 1,
            "description": [
                "You may decide that in some failure conditions all retry attempts should be aborted and instead the service should fail immediately. This prevents the service from retrying for conditions that you know the service cannot recover from, like a <code>FileNotFoundException</code>. The Retry policy also has a parameter to identify these exceptions.",
                "<ul><li><b>abortOn:</b>  Specifies an exception class that will stop retries and fail immediately. You can identify more than one exception as an array of values.  For example,<br><span style='margin-left: 10px;'><code>@Retry(abortOn={RuntimeException.class, FileNotFoundException.class})</code>.</span><br>There is no default value.",
                "</ul>"
            ],
            "instruction": [
                "Add a condition to the <code>@Retry</code> annotation beginning on line 14 to stop all retry attempts when a <code>FileNotFoundException</code> occurs, or click<br> <action title='Add @Retry with the abortOn parameter' onclick=\"retryTimeoutCallback.addRetryAnnotationButton(event, 'AddAbortOnRetry')\">@Retry(retryOn = TimeoutException.class,\n       maxRetries=4,\n       maxDuration=10,\n       durationUnit = ChronoUnit.SECONDS,\n       delay=200, delayUnit = ChronoUnit.MILLIS,\n       jitter=100,\n       jitterDelayUnit = ChronoUnit.MILLIS,\n       abortOn=FileNotFoundException.class)</action>.<br> This Retry policy will allow all timeouts from our service to be retried up to 4 times within 10 seconds of the original timeout failure, with a delay of 100 to 300 ms between retry attempts, but will halt all retry attempts and immediately return if a <code>FileNotFoundException</code> occurs.<br>Click <action title='Run' onclick=\"retryTimeoutCallback.saveButtonEditor(event, 'AddAbortOnRetry')\"><b>Run</b></action> on the editor menu pane.",
                "Enter the following URL into the browser that follows, or click <action title='URL to retrieve transaction history' onclick=\"retryTimeoutCallback.populateURL(event, 'AddAbortOnRetry')\"><b>https://global-ebank.openliberty.io/transactions</b></action> and then press <action title='Enter' onclick=\"retryTimeoutCallback.clickTransaction(event, 'AddAbortOnRetry', 0)\"><b>Enter</b></action> to retrieve the account transaction history.  This time we simulate a <code>FileNotFoundException</code> and the request to the View Transaction microservice fails and displays an error message without any Timeout or Retry processing."
            ],
            "content": [
                {
                    "displayType": "tabbedEditor",
                    "editorList": [
                        {
                            "displayType": "tabbedEditor",
                            "fileName": "BankService.java",
                            "preload": [
                                "package io.openliberty.guides.retrytimeout.global.eBank.microservices;",
                                "",
                                "import javax.enterprise.context.ApplicationScoped;",
                                "import java.io.FileNotFoundException",
                                "import java.time.temporal.ChronoUnit;",
                                "",
                                "import org.eclipse.microprofile.faulttolerance.Retry;",
                                "import org.eclipse.microprofile.faulttolerance.Timeout;",
                                "import org.eclipse.microprofile.faulttolerance.exceptions.TimeoutException;",
                                "",
                                "@ApplicationScoped",
                                "public class BankService {",
                                "",
                                "    @Retry(retryOn = TimeoutException.class,",
                                "           maxRetries=4,",
                                "           maxDuration=10,",
                                "           durationUnit = ChronoUnit.SECONDS,",
                                "           delay=200, delayUnit = ChronoUnit.MILLIS,",
                                "           jitter=100,",
                                "           jitterDelayUnit = ChronoUnit.MILLIS)",
                                "    @Timeout(2000)",
                                "    public Service showTransactions() throws Exception {",
                                "       Service transactions = new Transactions();",
                                "       transactions.getTransactions();",
                                "       return transactions;",
                                "   }",
                                "}"
                            ],
                            "readonly": [
                                {
                                    "from": "1",
                                    "to": "13"
                                },
                                {
                                    "from": "21",
                                    "to": "27"
                                }
                            ],
                            "editorHeight": "510px",
                            "save": false,
                            "callback": "(function test(editor) {retryTimeoutCallback.listenToEditorForInitialRetryAnnotation(editor); })"
                        }
                    ]
                },
                {
                    "displayType": "pod"
                }
            ]
        },
        {
            "name": "WhatNext",
            "title": "Great work!  You're done!",
            "description": [
                "You learned about the benefits of Retry and Timeout policies and how to make your microservice more resilient to failures. You learned that the Timeout policy can be used to quickly fail requests that are hanging for too long. You learned to use the Retry policy to re-attempt an operation that has failed and therefore recover from transient failures your application may experience.",
                "<p> <a href='https://github.com/OpenLiberty/iguide-retry-timeout/tree/master/finish' >Download the sample retry timeout application on github</a>.</p>"
             ]
        }
    ]
}
